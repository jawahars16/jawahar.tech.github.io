<!DOCTYPE html>
<html lang=" en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>NGINX - a real world comparison | Jawahar Selvaraj</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="NGINX - a real world comparison" />
<meta name="author" content="Jawahar Selvaraj" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="NGINX is an open-source web server that powers more than 400 million websites. In this article, I try to explain some of the core concepts of NGINX using real-life scenarios." />
<meta property="og:description" content="NGINX is an open-source web server that powers more than 400 million websites. In this article, I try to explain some of the core concepts of NGINX using real-life scenarios." />
<link rel="canonical" href="https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison" />
<meta property="og:url" content="https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison" />
<meta property="og:site_name" content="Jawahar Selvaraj" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-13T22:12:03+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NGINX - a real world comparison" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jawahar Selvaraj"},"dateModified":"2020-07-13T22:12:03+00:00","datePublished":"2020-07-13T22:12:03+00:00","description":"NGINX is an open-source web server that powers more than 400 million websites. In this article, I try to explain some of the core concepts of NGINX using real-life scenarios.","headline":"NGINX - a real world comparison","mainEntityOfPage":{"@type":"WebPage","@id":"https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison"},"url":"https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://jawahar.tech/feed.xml" title="Jawahar Selvaraj" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Jawahar Selvaraj</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/bytes/">Bytes</a><a class="page-link" href="/blog/">Blog</a><a class="page-link" href="/videos/">Videos</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">NGINX - a real world comparison</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-07-13T22:12:03+00:00" itemprop="datePublished">
        Jul 13, 2020
      </time></p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/reception.png" /></header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>NGINX is an open-source web server that powers more than 400 million websites. In this article, I try to explain some of the below core concepts of NGINX using real-life scenarios.</p>

<ul>
  <li>Reverse Proxy</li>
  <li>Load Balancing</li>
  <li>Concurrency</li>
  <li>SSL Offload</li>
</ul>

<hr />

<p>Alice got a new job as a receptionist in an insurance company.  Her responsibility is to greet the customers and listen to their requests patiently and address them. She is the face of the company to customers. Alice was excited about her first day.</p>
<h2 id="reverse-proxy">Reverse proxy</h2>
<p>Alice got her first customer Bob. Bob wanted to enquire about the late fee for his last premiums. Alice got the required details from Bob and asked him to wait in the lobby. Alice then went inside the office and talk to several officers and verified a few records and made few phone calls and finally, she came back to reception. She informed Bob about why he got late fees in his premiums. But Bob had a few other questions as well. Alice patiently listened to each request and went inside the office, talk to the officers, and addressed his requests.</p>

<p>Bob got curious. She asked Alice, why donâ€™t you let me inside, I go to officers directly and talk to them, verify the records and I can clarify all my questions. Alice refused. She knows why it is not the right way. Because that might expose the operation details and officerâ€™s identity of the company to outsiders and that might compromise the security.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/NGINX-argue.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<p><strong>What does that mean in NGINX?</strong></p>

<p>In a typical microservice architecture, multiple services work together to serve a request. NGINX knows to which backend service to be contacted to serve a particular request. Each microservice might be running in a different port, protocol, and host. NGINX exposes a single gateway to outside through which the external users can reach the application, thereby abstracting the internal implementation to outsiders. The purpose of a typical proxy server is to hide the client identity to the server, whereas the purpose of a reverse proxy is to hide the identity and implementation details of servers to clients.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/carbon-proxy.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<h2 id="load-balancing">Load Balancing</h2>

<p>One day, Alice got instructions from the company that said, that officers of particular departments cannot handle more requests at the same time.  That makes them tired and that impacts the overall performance of the company. So the management appointed additional officers in the same department and asked Alice to share the job across multiple officers in the same department. Alice decided to reach out to officers who have a lesser workload and sometimes she assigns in round-robin fashion. This approach works really great. But sometimes, few customers specifically wanted to work with particular officers. They have their own favorite officers ðŸ˜Š. And Alice makes sure she keep track of those customers and their favorite officers.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/NGINX-tired.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<p><strong>What does that mean in NGINX?</strong></p>

<p>Each microservice might be running as a server accepting requests through a specific protocol. The more requests a server handles, the sooner it might get slower because the CPU consumption might get increases as with more requests. At some point in time, the server might stop working and it impacts the overall applicationâ€™s availability. So it is a best practice to run multiple instances of the same service to ensure high resilience. And NGINX takes the responsibility of sharing the work across multiple instances. NGINX uses several approaches to decide which instance to reach - a basic round-robin, or least requests in the queue or configurable weight-based.</p>

<p>But sometimes, few clients prefer to reach out to some specific servers, because those servers maintain a server session to keep track of user login and other user specific details. Though this is not a highly recommended approach, NGINX offers option called <code class="language-plaintext highlighter-rouge">session affinity</code> or <code class="language-plaintext highlighter-rouge">sticky sessions</code> to enable this behavior.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/carbon-lb.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<h2 id="concurrency">Concurrency</h2>

<p>The company started gaining more reputation and that increases the number of daily customers. Like other officers in the company, Alice also started feeling the pressure. She got complaints saying that customers have to wait for a long time to get their problems resolved. Usually, Alice takes one customer request at a time and get into the office and deal with it. During this time, the other customers have to wait in the queue.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/NGINX-queue.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<p>To avoid this management came up with two solutions.</p>

<ol>
  <li>
    <p>When Alice gets a customer request, she has to find the corresponding department and hand over the request. And she shouldnâ€™t wait for the department to finish the requests. Instead, she should come back to the reception immediately and collect the next request. If the department completed processing the first request, Alice should collect the details and hand over it to the first customer. Yes, Alice has to keep track of the customers and their requests, but this approach reduces the wait time to a greater extent.</p>
  </li>
  <li>
    <p>Appoint more receptionists to handle more customers. This needs to be done with care though. Just increasing the receptionists to large numbers might put some of them into an idle situation since the officers might take some time to process each job. The number of receptionists has to be increased by keeping the officersâ€™ capacity in mind.</p>
  </li>
</ol>

<p><strong>What does that mean in NGINX?</strong></p>

<p>NGINX uses non-blocking IO to handle incoming requests. In a typical blocking connection, it has to wait for the response before it initiates a new connection to backend servers. Also, the typical web server follows the thread-per-request model, where the requests go to the waiting queue as soon as it runs out of available threads. The requests can only be processed when any one of the thread becomes available. But in NGINX, a single worker thread can handle multiple requests using the non-blocking model.</p>

<p>The number of worker threads can also be configured in NGINX. But the best practice is to keep the number of workers equal to the number of cores. If you cannot find the number of cores in your machine, it is better to leave it to NGINX by setting the value to <code class="language-plaintext highlighter-rouge">auto</code>.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/carbon-worker.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<h2 id="ssl-offload">SSL Offload</h2>

<p>Alice recently realized that the insurance company and customers sometimes share information and documents through postal (yes just assume that email wasnâ€™t invented yet ðŸ˜Š). The documents sometimes contain user sensitive information. To protect that data from intruders, customers and the company usually seal the documents with material that cannot be easily tampered.</p>

<p>Now the problem is, every time the company receives some documents, officers have to spend a considerable amount of time to unseal those envelopes (remember we said that the material is stronger ðŸ˜Š). Now Alice decided to solve this problem by taking the responsibility of collecting the documents from a sealed envelope. She seals the documents when it goes from the company to customers and she unseals the documents when she receives it from customers. That makes the job easier for officers so that they can focus on their core jobs.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/envelope.jpg" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<p><strong>What does that mean in NGINX?</strong></p>

<p>It is always a preferred approach to use a Secured HTTP protocol (SSL) for client-server communication. With this protocol, any data that transferred between the server and client will be encrypted. The client keeps the public key and the server keeps the private key. Whenever the server receives the request it needs to decrypt the data using the private key before it starts processing it.</p>

<p>The challenge here is that it requires more processing power for encryption/decryption of data. So this might impact the performance of the server and so the overall application. NGINX solves this problem by taking the responsibility of removing the SSL based encryption from incoming requests.</p>

<p><img src="/assets/blog/2020-07-13-nginx-a-real-world-comparison/carbon-ssl.png" alt="NGINX - real world comparison" title="NGINX - real world comparison" /></p>

<hr />

<p>Hope the above real-life comparison helps to understand the concepts easier. (The example scenario might not happen in real life as explained here. This is just to help readers understand NGINX better.)</p>

<p>Thanks to <a href="https://gramener.com/comicgen/">Comicgen</a> and <a href="https://carbon.now.sh/">Carbon</a></p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison';
      this.page.identifier = 'https://jawahar.tech/blog/2020-07-13-nginx-a-real-world-comparison';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://jawahar-tech.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/blog/2020-07-13-nginx-a-real-world-comparison" hidden></a>
</article>
    </div>
  </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://jawahar.tech/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          jawahar.tech Â© All rights reserved.
          <!-- <li class="p-name">Jawahar Selvaraj</li> -->
          
        </ul>
      </div>
      <div class="footer-col">
        <p>I am a Software Engineer passionate in Cloud engineering and Golang programming. I use this website to share my learnings.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://www.linkedin.com/in/jawaharselvaraj" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.youtube.com/@jawahar.nutshell" target="_blank" title="youtube">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.instagram.com/@jawahar.tech" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/jawahars16" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/jawahars_16" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://stackoverflow.com/users/1693776/jawahar" target="_blank" title="stackoverflow">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
<style>
    #cookie-notice {
        padding: 0.5rem 1rem;
        display: none;
        text-align: center;
        position: fixed;
        bottom: 0;
        width: calc(100% - 2rem);
        background: #222;
        color: rgba(255, 255, 255, 0.8);
    }

    #cookie-notice a {
        display: inline-block;
        cursor: pointer;
        margin-left: 0.5rem;
    }

    @media (max-width: 767px) {
        #cookie-notice span {
            display: block;
            padding-top: 3px;
            margin-bottom: 1rem;
        }

        #cookie-notice a {
            position: relative;
            bottom: 4px;
        }
    }
</style>
<div id="cookie-notice">
    <span>We would like to use third party cookies and scripts to improve the functionality of this
        website.</span>
    <a id="cookie-notice-accept" class="btn btn-primary btn-sm">Approve</a>
</div>
<script>
    function createCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name, "", -1);
    }

    if (readCookie('cookie-notice-dismissed') == 'true') {
    } else {
        document.getElementById('cookie-notice').style.display = 'block';
    }
    document.getElementById('cookie-notice-accept').addEventListener("click", function () {
        createCookie('cookie-notice-dismissed', 'true', 31);
        document.getElementById('cookie-notice').style.display = 'none';
        location.reload();
    });

</script>

</body>

</html>